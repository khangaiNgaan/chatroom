<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2fa settings - coffeeroom</title>
    <meta name="theme-color" content="#d8e3ed" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#242931" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/2fa.css">
    <script>
      (function() {
          const savedMode = localStorage.getItem('theme-mode') || 'auto';
          let isDark = false;
          let isMono = false;
          if (savedMode === 'auto') {
              isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          } else if (savedMode === 'mono') {
              isMono = true;
          } else {
              isDark = (savedMode === 'dark');
          }
          if (isDark) {
              document.documentElement.setAttribute('data-theme', 'dark');
          } else if (isMono) {
              document.documentElement.setAttribute('data-theme', 'mono');
          }
      })();
    </script>
  </head>
  <body>
    <div class="box">
        <div class="content">
          <div class="header">
            <span class="title">coffeeroom</span>
            <span class="themebtn">
              <span id="user-display">loading...</span>
              theme: <a href="#" id="darkModeButton">auto</a>
            </span>
          </div>
          
          <div class="title" style="margin: 30px 0 20px 0; font-size: 18px;">Two-factor Authentication</div>
          
          <div class="container-settings">
            
            <div id="auth-message" class="auth-message"></div>

            <div id="loading-state" class="note">checking status...</div>

            <!-- Enabled State -->
            <div id="2fa-enabled-ui" class="step">
                <div class="note" style="margin-bottom: 20px; color: var(--success-color);">
                    2FA is currently enabled.
                </div>
                <div class="title" style="font-size: 16px; margin-bottom: 10px;">Disable 2FA</div>
                <div class="note" style="margin-bottom: 10px;">Enter your password to disable 2FA.</div>
                <form id="disable-2fa-form" class="remove-form">
                    <div class="input-group">
                        <input type="password" id="disable-password" name="password" placeholder="confirm password" required />
                    </div>
                    <button type="submit" class="btn-remove">disable 2fa</button>
                </form>
            </div>

            <!-- Disabled State (Setup Wizard) -->
            <div id="2fa-disabled-ui" class="step">
                
                <!-- Initial Start Button -->
                <div id="step-start" class="step active">
                    <div class="note" style="margin-bottom: 20px;">
                        Protect your account with an extra layer of security. Once configured, you'll be required to enter both your password and an authentication code from your authenticator app in order to sign in.
                    </div>
                    <button id="btn-start-setup">enable 2fa</button>
                </div>

                <!-- Step 1: Scan QR -->
                <div id="step-1" class="step">
                    <div class="title" style="font-size: 16px; margin-bottom: 10px;">Step 1: Scan QR Code</div>
                    <div class="note">Use an authenticator app (e.g. Apple Passwords, Google Authenticator) to scan the QR code below.</div>
                    <div id="qrcode"></div>
                    <div class="note" style="margin-bottom: 10px;">
                       Or enter this code manually: <span id="secret-text" class="secret-key-display"></span>
                    </div>
                    <div class="action-row">
                       <button id="btn-next-to-verify">next</button>
                       <button id="btn-cancel-setup-1">cancel</button>
                    </div>
                </div>

                <!-- Step 2: Verify -->
                <div id="step-2" class="step">
                    <div class="title" style="font-size: 16px; margin-bottom: 10px;">Step 2: Verify Code</div>
                    <div class="note" style="margin-bottom: 10px;">Enter the 6-digit code generated by your authenticator app.</div>
                    <form id="verify-2fa-form">
                        <div class="input-group">
                            <input type="text" id="verify-code" placeholder="000000" maxlength="6" inputmode="numeric" required />
                        </div>
                        <div class="action-row">
                            <button type="submit">verify and enable</button>
                            <button type="button" id="btn-cancel-setup-2">cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Step 3: Recovery Codes -->
                <div id="step-3" class="step">
                    <div class="title" style="font-size: 16px; margin-bottom: 10px;">Step 3: Save Recovery Codes</div>
                    <div class="note" style="color: var(--error-color); margin-bottom: 10px;">Save these codes. They are the only way to recoever your account if you lose your device.</div>
                    <div class="recovery-codes" id="recovery-codes-list"></div>
                    <div class="action-row">
                        <button id="btn-download-recovery">download codes</button>
                        <button id="btn-finish-setup" style="margin-left: 10px;">I have saved them</button>
                    </div>
                </div>

            </div>
          </div>

          <br>
          <div class="back"><a href="/user/settings.html">&lt; back to settings</a></div>
        </div>
        <footer>
          <span class="copyright">Copyright (c) 2025-2026 <a href="https://caffeine.ink" target="_blank" rel="noopener noreferrer">caffeine-Ink</a>. Licensed under <a href="https://caffeine.ink/pages/agpl-3.0-standalone.html" target="_blank" rel="noopener noreferrer">AGPLv3</a>.</span>
        </footer>
    </div>
    <script src="/scripts/theme.js"></script>
    <script defer src="/scripts/favicon.js"></script>
    <script src="/scripts/version.js"></script>
    <script src="/scripts/2fa.js"></script>
  </body>
</html>
